@model List<NewBrainfieldNetCore.Entities.uspGetStudentExam>

@{
    Layout = "_FrontendLayout";
}

<style>
    .badge {
        font-size: 1.00em;
        font-weight: 800;
    }
</style>

<div class="page-title mt-30">
    <div class="d-table">
        <div class="d-table-cell">
            <div class="container">
                <h3>My Exams</h3>
            </div>
        </div>
    </div>
</div>

<section class="cart-area ptb-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <div class="cart-table table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">OrderId</th>
                                <th scope="col">Exam Name</th>
                                <th scope="col">Repetation</th>
                                <th scope="col">Appear</th>
                                <th scope="col">Details</th>
                                <th scope="col">Apply</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var x in Model)
                            {
                                <tr>
                                    <input type="hidden" value="@x.OrderId" class="OrderId" />
                                    <td>@x.OrderId</td>
                                    <td>@x.ExamName</td>
                                    <td>
                                        <span class="badge bg-success">
                                            @x.Repetation
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">
                                            @x.Appear
                                        </span>
                                    </td>
                                    <td class="OrderDetails">
                                        <a class="btn btn-info">
                                            Order Details
                                        </a>
                                    </td>
                                    <td>
                                        <a asp-action="Index" asp-controller="ApplyExam" asp-route-ExamId="@x.ExamID" asp-route-OrderId="@x.OrderId" class="btn btn-primary">
                                            Take Exam
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="OrderModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-bs-dismiss="modal">&times;</button>
                <h4 class="modal-title">Order Details</h4>
            </div>
            <div class="modal-body">
                <table class="table table-hover" id="orderModal">
                    <thead>
                        <tr>
                            <th>Order No</th>
                            <th>Placed On</th>
                            <th>Price</th>
                    </thead>
                    <tbody id="orderModalBody"></tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <script type="text/javascript">
        $(".OrderDetails").click(function (e) {
            var row = $(this).closest("tr");
            var id = row.find(".OrderId").val();

            console.log(id);

            var url = "/Student/UserAccount/GetOrderDetail?id=" + id;

            console.log(url);

            $.getJSON(url, function (data) {
                console.log(data);
                for (var i = 0; i < data.length; i++) {
                    var dt = ToJavaScriptDate(data[i].placedOn);
                    var tr;
                    tr = $('<tr/>');
                    tr.append("<td> #" + data[i].orderNo + "</td>");
                    tr.append("<td>" + dt + "</td>");
                    tr.append("<td> ₹" + data[i].price + "</td>");
                    $('#orderModalBody').html(tr);
                }
                $('#OrderModal').modal('show');
            });
        });
        function ToJavaScriptDate(value) {
            var pattern = /Date\(([^)]+)\)/;
            var results = pattern.exec(value);
            var dt = new Date(parseFloat(results[1]));
            return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
        }
    </script>
}